<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Users">


	<sql id="defCond">
		<where>
			<if test="userName != null and userName != ''">
				AND T.USER_NAME like '%' || #{userName} || '%'
			</if>
			<if test="comNo != null and comNo != ''">
				AND T.com_no = #{comNo}
			</if>
		</where>
	</sql>


	
	
	<select id="selectListCount" resultType="int">
		SELECT COUNT(*) FROM TB_USER_MST T 
		<include refid="defCond"></include>
	</select>

	<select id="selectList" resultType="egovMap">
     SELECT *
	   FROM (
            SELECT t.com_no
					, t.user_id            
					, t.user_name               
					, t.com_depart_code          
					, (select dept_name from tb_depart_mst d where dept_code=t.com_depart_code) dept_full_name    
					, t.com_jobx        
					, cd_job.code_nm com_jobx_nm                     
					, t.com_position                    
					, get_code_nm('POSITION', com_position) com_position_nm            
					, t.com_cert_belt              
					, cd_blt.code_nm com_cert_belt_nm       
              FROM tb_user_mst T
                   LEFT OUTER JOIN tb_code cd_job ON cd_job.code_grp_id='JOBX' AND cd_job.code_id=T.com_jobx
                   LEFT OUTER JOIN tb_code cd_blt ON cd_blt.code_grp_id='LDRBELT' AND cd_blt.code_id=T.com_cert_belt 
		<include refid="defCond"></include>
		    )
		ORDER BY COM_JOBX ASC, USER_NAME
	</select>

</mapper>

