<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="AttachFile">

	<sql id="fullCond">
		<where>
			<trim prefixOverrides="AND|OR">
			  	<if test="fileId != null and fileId != ''">
					AND FILE_ID = #{fileId}
			  	</if>
			  	<if test="fileSeq != null and fileSeq != ''">
					AND FILE_SEQ = #{fileSeq}
			  	</if>
			  	<if test="deleteFlg != null and deleteFlg != ''">
					AND DELETE_FLG = #{deleteFlg}
			  	</if>
			</trim>
		</where>
	</sql>

	<select id="selectFullList" resultType="kr.freedi.dev.attachfile.domain.AttachFileVO">
		SELECT
			T.FILE_ID fileId
			,T.FILE_SEQ fileSeq
			,T.FILE_GRP fileGrp
			,T.FILE_NM fileNm
			,T.FILE_SIZ fileSiz
			,T.FILE_MSK fileMsk
			,T.DWNLD_CNT dwnldCnt
			,T.DELETE_FLG deleteFlg
			,T.OPER_DT operDt
		FROM TB_ATTACH_FILE T
		<include refid="fullCond"></include>
		ORDER BY T.FILE_ID ASC, T.FILE_SEQ ASC
	</select>
	
	<select id="select" resultType="kr.freedi.dev.attachfile.domain.AttachFileVO">
		SELECT 
			T.FILE_ID fileId
			,T.FILE_SEQ fileSeq
			,T.FILE_GRP fileGrp
			,T.FILE_NM fileNm
			,T.FILE_SIZ fileSiz
			,T.FILE_MSK fileMsk
			,T.DWNLD_CNT dwnldCnt
			,T.DELETE_FLG deleteFlg
			,T.OPER_DT operDt
		FROM TB_ATTACH_FILE T 
		WHERE T.FILE_ID = #{fileId}
		AND T.FILE_SEQ = #{fileSeq}
	</select>
	
	<select id="selectByFileMsk" resultType="kr.freedi.dev.attachfile.domain.AttachFileVO">
		SELECT 
			T.FILE_ID fileId
			,T.FILE_SEQ fileSeq
			,T.FILE_GRP fileGrp
			,T.FILE_NM fileNm
			,T.FILE_SIZ fileSiz
			,T.FILE_MSK fileMsk
			,T.DWNLD_CNT dwnldCnt
			,T.DELETE_FLG deleteFlg
			,T.OPER_DT operDt
		FROM TB_ATTACH_FILE T 
		WHERE T.FILE_MSK = #{fileMsk}
	</select>

	<insert id="insert">
		<selectKey keyProperty="fileSeq" resultType="int"  order="BEFORE">
			SELECT NVL(MAX(FILE_SEQ), 0) + 1 fileSeq FROM TB_ATTACH_FILE WHERE FILE_ID = #{fileId}
		</selectKey>
		INSERT INTO TB_ATTACH_FILE (
			FILE_ID
			,FILE_SEQ
			,FILE_GRP
			,FILE_NM
			,FILE_SIZ
			,FILE_MSK
			,DWNLD_CNT
			,DELETE_FLG
			,OPER_DT
		) VALUES (
			#{fileId}
			,#{fileSeq}
			,#{fileGrp}
			,#{fileNm}
			,#{fileSiz}
			,#{fileMsk}
			,#{dwnldCnt}
			,#{deleteFlg}
			,SYSDATE()
		)
	</insert>

	<update id="updateByFileIdAndFileSeq">
		UPDATE TB_ATTACH_FILE
		SET 
			FILE_NM = #{fileNm}
			,FILE_SIZ = #{fileSiz}
			,FILE_MSK = #{fileMsk}
			,DWNLD_CNT = #{dwnldCnt}
			,DELETE_FLG = #{deleteFlg}
		WHERE FILE_ID = #{fileId}
		AND FILE_SEQ = #{fileSeq}
	</update>

	<update id="updateDeleteFlgByFileId">
		UPDATE TB_ATTACH_FILE
		SET 
			DELETE_FLG = #{deleteFlg}
		WHERE FILE_ID = #{fileId}
	</update>
		
	<update id="updateDeleteFlgByFileIdAndFileSeq">
		UPDATE TB_ATTACH_FILE
		SET 
			DELETE_FLG = #{deleteFlg}
		WHERE FILE_ID = #{fileId}
		AND FILE_SEQ = #{fileSeq}
	</update>

	<update id="updateDwnldCntByFileId">
		UPDATE TB_ATTACH_FILE
		SET 
			DWNLD_CNT = DWNLD_CNT + 1
		WHERE FILE_ID = #{fileId}
	</update>
		
	<update id="updateDwnldCntByFileIdAndFileSeq">
		UPDATE TB_ATTACH_FILE
		SET 
			DWNLD_CNT = DWNLD_CNT + 1
		WHERE FILE_ID = #{fileId}
		AND FILE_SEQ = #{fileSeq}
	</update>

	<delete id="deleteByFileId">
		DELETE FROM TB_ATTACH_FILE
		WHERE FILE_ID = #{fileId}
	</delete>
	
	<delete id="deleteByFileIdAndFileSeq">
		DELETE FROM TB_ATTACH_FILE
		WHERE FILE_ID = #{fileId}
		AND FILE_SEQ = #{fileSeq}
	</delete>
	
</mapper>

